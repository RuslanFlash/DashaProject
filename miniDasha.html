<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <title>–î–ª—è –î–∞—à–∏ ‚ù§</title>
  <style>
    :root {
      --bg: #0b0c10;
      --fg: #ffffff;
      --accent: #ff4d6d;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      background: var(--bg);
      color: var(--fg);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      overflow: hidden;
    }

    /* Background carousel */
    .bg {
      position: fixed; inset: 0; z-index: 0; overflow: hidden;
      filter: blur(4px) saturate(1.1);
      transform: scale(1.02);
    }
    .bg img { position: absolute; width: 100%; height: 100%; object-fit: cover; opacity: 0; transition: opacity 1.2s ease; }
    .bg img.active { opacity: 0.55; }

    /* Overlay gradient for readability */
    .vignette { position: fixed; inset: 0; z-index: 1;
      background: radial-gradient(ellipse at center, rgba(0,0,0,0.0) 0%, rgba(0,0,0,0.35) 60%, rgba(0,0,0,0.6) 100%);
      pointer-events: none;
    }

    /* Canvas for particles */
    #canvas { position: fixed; inset: 0; z-index: 2; display: block; }

    /* UI text */
    .hud {
      position: fixed; left: 50%; bottom: 24px; transform: translateX(-50%);
      z-index: 3; text-align: center; pointer-events: none;
      padding: 10px 14px; border-radius: 16px; background: rgba(0,0,0,0.35);
      backdrop-filter: blur(6px);
      font-size: 14px; line-height: 1.2;
    }
    .hud b { color: var(--accent); }

    /* Floating tap hearts */
    .pop-heart { position: fixed; width: 22px; height: 22px; z-index: 4; pointer-events: none; opacity: 0; }
    .pop-heart::before { content: "‚ù§"; font-size: 22px; display: block; color: var(--accent); text-shadow: 0 0 8px rgba(255,77,109,0.8); }
    @keyframes floatUp { 0%{ transform: translate(-50%, -50%) scale(0.6); opacity: 0;} 10%{opacity:1} 100%{ transform: translate(-50%, -140%) scale(1.6); opacity: 0; } }
  </style>
</head>
<body>
  <!-- Background Carousel -->
  <div class="bg" id="bg"></div>
  <div class="vignette"></div>
  <canvas id="canvas"></canvas>
  <div class="hud">–ù–∞–∂–∏–º–∞–π –Ω–∞ —ç–∫—Ä–∞–Ω ‚Äî —á–∞—Å—Ç–∏—Ü—ã <b>—Ä–µ–∞–≥–∏—Ä—É—é—Ç</b> –∏ —Å–Ω–æ–≤–∞ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –≤ <b>—Å–µ—Ä–¥—Ü–µ</b> —Å —Ç–≤–æ–∏–º –∏–º–µ–Ω–µ–º üí´</div>

  <script>
    // =========================
    // ‚ú® CONFIG (–ø–æ–¥—Å—Ç–∞–≤—å —Å–≤–æ—ë)
    // =========================
    const NAME = "–î–∞—à–∞"; // –ò–º—è –≤–Ω—É—Ç—Ä–∏ —Å–µ—Ä–¥—Ü–∞
    const HEART_COLOR = '#ff4d6d';
    const PARTICLE_COLOR = '#ffd6de';
    const PARTICLES_COUNT = 1400; // 900‚Äì2000 —Ö–æ—Ä–æ—à–æ –¥–ª—è –º–æ–±–∏–ª–æ–∫
    const REASSEMBLE_DELAY_MS = 450; // –ø–æ—Å–ª–µ –≤–∑—Ä—ã–≤–∞ —á–µ—Ä–µ–∑ —Å–∫–æ–ª—å–∫–æ –Ω–∞—á–∞—Ç—å —Å–æ–±–∏—Ä–∞—Ç—å—Å—è

    // –§–æ—Ç–æ –¥–ª—è —Ñ–æ–Ω–∞ (–ø–æ–¥—Å—Ç–∞–≤—å —Å–≤–æ–∏ –ø—É—Ç–∏/URL)
    const PHOTOS = [
      // –ü—Ä–∏–º–µ—Ä—ã-–∑–∞–≥–ª—É—à–∫–∏. –ó–∞–º–µ–Ω–∏ –Ω–∞ —Å–≤–æ–∏ URL/—Ñ–∞–π–ª—ã.
      'https://images.unsplash.com/photo-1529156069898-49953e39b3ac?q=80&w=1920&auto=format',
      'https://images.unsplash.com/photo-1518199266791-5375a83190b7?q=80&w=1920&auto=format',
      'https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?q=80&w=1920&auto=format',
      'https://images.unsplash.com/photo-1504194104404-433180773017?q=80&w=1920&auto=format'
    ];

    const SLIDE_INTERVAL = 4200; // –º—Å –º–µ–∂–¥—É —Å–º–µ–Ω–æ–π —Ñ–æ—Ç–æ

    // =========================
    // Telegram WebApp integration (–±–µ–∑–æ–ø–∞—Å–Ω–æ, –µ—Å–ª–∏ –Ω–µ –≤ Telegram)
    // =========================
    (function initTelegram(){
      const tg = window.Telegram && window.Telegram.WebApp;
      if (!tg) return;
      try {
        tg.ready();
        tg.expand();
        if (tg.themeParams && tg.themeParams.bg_color) {
          document.documentElement.style.setProperty('--bg', tg.themeParams.bg_color);
        }
        if (tg.themeParams && tg.themeParams.text_color) {
          document.documentElement.style.setProperty('--fg', tg.themeParams.text_color);
        }
        if (tg.themeParams && tg.themeParams.button_color) {
          document.documentElement.style.setProperty('--accent', tg.themeParams.button_color);
        }
      } catch (e) { /* ignore */ }
    })();

    // =========================
    // Background Carousel
    // =========================
    const bg = document.getElementById('bg');
    let slideIndex = 0; let slideEls = [];
    function buildCarousel(){
      bg.innerHTML = '';
      slideEls = PHOTOS.map((src, i) => {
        const img = document.createElement('img');
        img.src = src; if (i === 0) img.classList.add('active');
        bg.appendChild(img); return img;
      });
    }
    function nextSlide(){
      if (slideEls.length === 0) return;
      slideEls[slideIndex].classList.remove('active');
      slideIndex = (slideIndex + 1) % slideEls.length;
      slideEls[slideIndex].classList.add('active');
    }

    // =========================
    // Particles in Heart
    // =========================
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    let W = innerWidth, H = innerHeight;
    canvas.width = W; canvas.height = H;

    const DPR = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
    canvas.width = W * DPR; canvas.height = H * DPR; ctx.scale(DPR, DPR);

    let particles = [];
    let targets = [];
    let exploded = false; // —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è
    let lastTapAt = 0;

    function resize(){
      W = innerWidth; H = innerHeight;
      canvas.style.width = W + 'px'; canvas.style.height = H + 'px';
      canvas.width = W * DPR; canvas.height = H * DPR; ctx.setTransform(DPR, 0, 0, DPR, 0, 0);
      // –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å —Ü–µ–ª–∏ –ø–æ–¥ –Ω–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä
      targets = buildHeartTargets();
      if (!particles.length) { initParticles(); }
    }
    window.addEventListener('resize', resize);

    function buildHeartPath(context, cx, cy, size){
      // –£—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å–µ—Ä–¥—Ü–∞ (Bezier) –¥–ª—è –≥–ª–∞–¥–∫–æ–π –º–∞—Å–∫–∏
      context.beginPath();
      context.moveTo(cx, cy + size * 0.35);
      context.bezierCurveTo(cx - size, cy - size * 0.2, cx - size * 0.2, cy - size * 0.9, cx, cy - size * 0.45);
      context.bezierCurveTo(cx + size * 0.2, cy - size * 0.9, cx + size, cy - size * 0.2, cx, cy + size * 0.35);
      context.closePath();
    }

    function buildHeartTargets(){
      const off = document.createElement('canvas');
      const octx = off.getContext('2d');
      const size = Math.min(W, H) * 0.36; // —Ä–∞–∑–º–µ—Ä —Å–µ—Ä–¥—Ü–∞
      off.width = Math.max(1, Math.floor(W));
      off.height = Math.max(1, Math.floor(H));

      // –†–∏—Å—É–µ–º —Å–µ—Ä–¥—Ü–µ
      octx.clearRect(0,0,off.width, off.height);
      buildHeartPath(octx, W/2, H/2, size);
      octx.fillStyle = HEART_COLOR;
      octx.fill();

      // –¢–µ–∫—Å—Ç –ø–æ —Ü–µ–Ω—Ç—Ä—É
      const fontSize = Math.max(26, Math.floor(size * 0.24));
      octx.font = `700 ${fontSize}px system-ui, -apple-system, Segoe UI, Roboto, Arial`;
      octx.textAlign = 'center'; octx.textBaseline = 'middle';
      octx.fillStyle = '#ffffff';
      octx.fillText(NAME, W/2, H/2);

      // –ë–µ—Ä—ë–º —Ç–æ—á–∫–∏ –ø–æ –ø–∏–∫—Å–µ–ª—è–º
      const img = octx.getImageData(0,0,off.width, off.height).data;
      const points = [];
      const gap = Math.max(3, Math.floor(Math.sqrt((W*H)/PARTICLES_COUNT*1.6))); // –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —à–∞–≥
      for (let y = 0; y < H; y += gap) {
        for (let x = 0; x < W; x += gap) {
          const i = (y * off.width + x) * 4;
          const alpha = img[i+3];
          if (alpha > 10) {
            points.push({x, y});
          }
        }
      }
      // –ï—Å–ª–∏ —Ç–æ—á–µ–∫ –±–æ–ª—å—à–µ, —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ –ø—Ä–æ—Ä–µ–¥–∏–º
      while (points.length > PARTICLES_COUNT) {
        points.splice(Math.floor(Math.random()*points.length), 1);
      }
      return points;
    }

    function initParticles(){
      particles = new Array(targets.length).fill(0).map((_, i) => {
        const t = targets[i];
        const angle = Math.random() * Math.PI * 2;
        const radius = Math.random() * Math.max(W, H);
        return {
          x: Math.cos(angle) * radius + W/2,
          y: Math.sin(angle) * radius + H/2,
          vx: 0, vy: 0,
          tx: t.x, ty: t.y,
          size: 1 + Math.random()*1.6,
        };
      });
    }

    function step(dt){
      ctx.clearRect(0,0,W,H);

      // —Ñ–æ–Ω–æ–≤—ã–µ –º—è–≥–∫–∏–µ —á–∞—Å—Ç–∏—Ü—ã —Å–≤–µ—á–µ–Ω–∏—è (–¥–æ–±–∞–≤–∏–º –ª—ë–≥–∫–æ–µ —Å–≤–µ—á–µ–Ω–∏–µ –∫–∏—Å—Ç—å—é)
      ctx.globalCompositeOperation = 'lighter';
      for (let i = 0; i < particles.length; i++){
        const p = particles[i];
        // —Å–∏–ª—ã
        const dx = p.tx - p.x; const dy = p.ty - p.y;
        const dist = Math.hypot(dx, dy) + 0.0001;
        const spring = 0.045; // —Å–∏–ª–∞ –ø—Ä–∏—Ç—è–∂–µ–Ω–∏—è –∫ —Ü–µ–ª–∏
        const damping = 0.86; // –∑–∞—Ç—É—Ö–∞–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏

        p.vx += dx * spring * dt; 
        p.vy += dy * spring * dt;

        p.vx *= damping; p.vy *= damping;
        p.x += p.vx * dt * 60; p.y += p.vy * dt * 60;

        // –†–∏—Å—É–µ–º
        ctx.beginPath();
        ctx.fillStyle = PARTICLE_COLOR;
        ctx.arc(p.x, p.y, p.size, 0, Math.PI*2);
        ctx.fill();
      }
      ctx.globalCompositeOperation = 'source-over';

      // –º—è–≥–∫–∏–π –∫–æ–Ω—Ç—É—Ä —Å–µ—Ä–¥—Ü–∞
      ctx.save();
      ctx.globalAlpha = 0.13;
      buildHeartPath(ctx, W/2, H/2, Math.min(W,H)*0.36);
      ctx.fillStyle = HEART_COLOR;
      ctx.fill();
      ctx.restore();
    }

    let last = performance.now();
    function loop(now){
      const dt = Math.min(0.05, (now - last)/1000); last = now;
      step(dt);
      requestAnimationFrame(loop);
    }

    function explode(x, y){
      // –º–∞–ª–µ–Ω—å–∫–∏–µ –≤—Å–ø–ª—ã–≤–∞—é—â–∏–µ —Å–µ—Ä–¥–µ—á–∫–∏
      spawnTapHeart(x, y);

      const power = Math.min(420, Math.max(W,H) * 0.6);
      for (let i = 0; i < particles.length; i++){
        const p = particles[i];
        const dx = p.x - x; const dy = p.y - y;
        const d2 = dx*dx + dy*dy + 0.0001;
        const force = power / d2; // –æ–±—Ä–∞—Ç–Ω–∞—è –∫–≤–∞–¥—Ä–∞—Ç–∏—á–Ω–∞—è
        const angle = Math.atan2(dy, dx);
        p.vx += Math.cos(angle) * force * 30;
        p.vy += Math.sin(angle) * force * 30;
      }
      exploded = true; lastTapAt = performance.now();
      setTimeout(() => {
        // –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç—å —Ü–µ–ª–∏ (–Ω–∞ —Å–ª—É—á–∞–π —Ä–µ—Å–∞–π–∑–∞) –∏ –≤–µ—Ä–Ω—É—Ç—å —Å–±–æ—Ä–∫—É
        targets = buildHeartTargets();
        particles.forEach((p, i) => { p.tx = targets[i % targets.length].x; p.ty = targets[i % targets.length].y; });
        exploded = false;
      }, REASSEMBLE_DELAY_MS);
    }

    function spawnTapHeart(x, y){
      const el = document.createElement('div');
      el.className = 'pop-heart';
      el.style.left = x + 'px'; el.style.top = y + 'px';
      el.style.animation = 'floatUp 900ms ease-out forwards';
      document.body.appendChild(el);
      setTimeout(() => el.remove(), 950);
    }

    // Pointer events
    function getXY(e){
      if (e.touches && e.touches[0]) return { x: e.touches[0].clientX, y: e.touches[0].clientY };
      return { x: e.clientX, y: e.clientY };
    }
    window.addEventListener('pointerdown', (e) => {
      const {x,y} = getXY(e); explode(x, y);
    });
    window.addEventListener('touchstart', (e) => { const {x,y} = getXY(e); explode(x, y); }, {passive:true});

    // Init all
    buildCarousel();
    setInterval(nextSlide, SLIDE_INTERVAL);
    targets = buildHeartTargets();
    initParticles();
    requestAnimationFrame(loop);

    // –î–≤–æ–π–Ω–æ–π —Ç–∞–ø ‚Äì –º—è–≥–∫–∞—è –≤—Å–ø—ã—à–∫–∞ (–ø–∞—Å—Ö–∞–ª–∫–∞)
    window.addEventListener('dblclick', (e)=>{
      const {x,y} = getXY(e);
      for (let i=0;i<4;i++) setTimeout(()=>explode(x + (Math.random()*40-20), y + (Math.random()*40-20)), i*90);
    });
  </script>
</body>
</html>
